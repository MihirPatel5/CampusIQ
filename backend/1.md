# School ERP System - Part 1: System Overview & User Flows
## Complete Functional Specification

**Version:** 1.0  
**Date:** December 31, 2024  
**Tech Stack:** Django + DRF, PostgreSQL, JWT Auth, API-First Design

---

## Table of Contents

1. System Overview
2. User Roles & Permissions
3. Complete User Flows
4. Module Specifications

---

# 1. SYSTEM OVERVIEW

## 1.1 Purpose
A comprehensive School ERP system with **API-First Architecture** supporting:
- **Admin** - Complete system management
- **Teacher** - Academic operations, attendance, assessments
- **Student** - Academic records, attendance, fee status
- **Parent** - Future-ready module

## 1.2 Core Principles
1. **API-First**: Every action is an independent API endpoint
2. **Atomic Functions**: No monolithic functions; granular APIs for AI automation
3. **AI-Ready**: All operations can be triggered by LLM agents
4. **Stateless**: JWT-based authentication
5. **Auditable**: Complete audit trail
6. **Scalable**: Modular design

## 1.3 Technology Stack
- **Backend:** Django 5.X or latest stable version + Django REST Framework
- **Database:** PostgreSQL 16+
- **Authentication:** JWT (djangorestframework-simplejwt)
- **API Documentation:** drf-spectacular (Swagger/OpenAPI)
- **Deployment:** VPS with Gunicorn + Nginx + SSL

## 1.4 Milestone Structure

### Milestone 1: Foundation (₹10,000)
- Admin authentication & dashboard
- School profile management
- Teacher account creation
- Class, Section, Subject management
- Subject assignment to Class+Section
- Database ER Diagram

### Milestone 2: Core Operations (₹16,000)
- Student admission flow
- Daily attendance system
- Fee management (structure, invoicing, collection)
- Complete API documentation
- Postman collection

### Milestone 3: Deployment (₹14,000)
- Exam module
- Reports system
- VPS deployment with SSL
- Source code handover
- Environment configuration guide

---

# 2. USER ROLES & PERMISSIONS

## 2.1 Role Definitions

### Admin (Superuser)
- Full CRUD on all entities
- User management
- School profile management
- System configuration
- View all reports
- Audit log access

### Teacher
- View assigned classes/sections/subjects
- Mark attendance for assigned classes
- Enter exam marks for assigned subjects
- View student profiles (academic only)
- Generate class-wise reports
- **Cannot** access fee information

### Student
- View own attendance records
- View own exam results
- View own fee status and invoices
- Download fee receipts
- Update own profile (limited)

### Parent (Future)
- View child's attendance
- View child's exam results
- View child's fee status
- Receive notifications

## 2.2 Permission Matrix

| Action | Admin | Teacher | Student | Parent |
|--------|-------|---------|---------|--------|
| Update school profile | ✅ | ❌ | ❌ | ❌ |
| Create teacher | ✅ | ❌ | ❌ | ❌ |
| Create student | ✅ | ❌ | ❌ | ❌ |
| Create classes/sections/subjects | ✅ | ❌ | ❌ | ❌ |
| Mark attendance | ✅ | ✅ (assigned) | ❌ | ❌ |
| View attendance | ✅ | ✅ (assigned) | ✅ (own) | ✅ (child) |
| Create fee structure | ✅ | ❌ | ❌ | ❌ |
| Collect fees | ✅ | ❌ | ❌ | ❌ |
| View fees | ✅ | ❌ | ✅ (own) | ✅ (child) |
| Create exams | ✅ | ✅ (assigned) | ❌ | ❌ |
| Enter marks | ✅ | ✅ (assigned) | ❌ | ❌ |
| View results | ✅ | ✅ (assigned) | ✅ (own) | ✅ (child) |

---

# 3. COMPLETE USER FLOWS

## 3.1 Admin Flows

### 3.1.1 Admin Login
```
1. Admin navigates to login endpoint
2. Enters username/email and password
3. System validates credentials
4. System generates JWT tokens (access + refresh)
5. Returns tokens and user info
6. Admin stores tokens and accesses dashboard
```

**API:** `POST /api/v1/auth/login/`

### 3.1.2 Update School Name & Logo
```
1. Admin navigates to school settings
2. Views current school data
3. Updates name/logo via form
4. System validates (name max 200 chars, logo max 2MB)
5. System updates database
6. School name/logo updated across all pages
```

**APIs:**
- `GET /api/v1/school/profile/` - Get profile
- `PATCH /api/v1/school/profile/` - Update profile

### 3.1.3 Create Teacher Account
```
1. Admin fills teacher form:
   - Personal details (name, email, phone, DOB)
   - Employee ID (optional, unique)
   - Joining date
   - Qualification
   - Password
2. System validates:
   - Email/phone uniqueness
   - Password strength (min 8 chars)
3. System creates user account (role: teacher) + teacher profile
4. Teacher can now login
```

**API:** `POST /api/v1/teachers/`

### 3.1.4 Create Classes
```
1. Admin creates class:
   - Name (e.g., "Class 10")
   - Code (e.g., "C10") - unique
   - Academic Year (e.g., "2024-25")
2. System validates code uniqueness
3. System creates class record
```

**API:** `POST /api/v1/classes/`

### 3.1.5 Create Sections
```
1. Admin selects class
2. Creates section:
   - Name (e.g., "A", "B")
   - Code (e.g., "10-A") - unique within class
   - Capacity (optional)
   - Room number (optional)
3. System validates code uniqueness within class
4. System creates section record
```

**API:** `POST /api/v1/sections/`

### 3.1.6 Create Subjects
```
1. Admin creates subject:
   - Name (e.g., "Mathematics")
   - Code (e.g., "MATH") - unique
   - Type (core/elective/optional)
   - Max marks (default: 100)
2. System validates code uniqueness
3. System creates subject record
```

**API:** `POST /api/v1/subjects/`

### 3.1.7 Assign Subjects to Class+Section
```
1. Admin selects class, section, subject, teacher
2. System validates:
   - No duplicate assignment
   - Teacher is active
3. System creates assignment
4. Teacher can see assignment in dashboard
```

**API:** `POST /api/v1/assignments/`

---

## 3.2 Teacher Flows

### 3.2.1 Teacher Login
Same as admin login, role: "teacher"

### 3.2.2 Teacher Dashboard
Shows:
- Assigned classes and sections
- Assigned subjects
- Today's attendance status
- Pending mark entries
- Upcoming exams

**API:** `GET /api/v1/dashboard/teacher/`

### 3.2.3 Mark Attendance
```
1. Teacher selects date, class, section
2. System loads students for that class+section
3. Teacher marks each student (present/absent/late/leave)
4. System validates:
   - Date not in future
   - Teacher has permission for this class+section
   - No duplicate attendance
5. System creates attendance records
6. System updates statistics
```

**APIs:**
- `GET /api/v1/attendance/mark/` - Get students
- `POST /api/v1/attendance/mark/` - Mark attendance

---

## 3.3 Student Flows

### 3.3.1 Student Admission (Admin Action)
```
1. Admin fills admission form:
   - Personal details (name, DOB, gender, blood group)
   - Contact (email, phone, address, city, state, pincode)
   - Academic (admission number, class, section)
   - Parent details (father, mother, guardian)
2. System validates:
   - Email/phone/aadhaar uniqueness
   - Admission number uniqueness
   - Section capacity
3. System creates:
   - User account (role: student)
   - Student profile
   - Parent records
4. Student can now login
```

**API:** `POST /api/v1/students/`

### 3.3.2 Student Dashboard
Shows:
- Own attendance summary
- Own exam results
- Own fee status
- Pending invoices

**API:** `GET /api/v1/dashboard/student/`

---

## 3.4 Fee Management Flows

### 3.4.1 Create Fee Structure
```
1. Admin creates fee structure:
   - Name (e.g., "Class 10 Annual Fee 2024-25")
   - Academic year
   - Class (or all classes)
   - Fee items (name, amount, due date, installment)
2. System calculates total amount
3. System creates fee structure + fee items
```

**API:** `POST /api/v1/fees/structures/`

### 3.4.2 Generate Invoice
```
1. Admin selects:
   - Fee structure
   - Students (individual or bulk by class/section)
2. System creates invoices for each student
3. System generates invoice numbers
4. System sets due dates
```

**API:** `POST /api/v1/fees/invoices/generate/`

### 3.4.3 Fee Collection
```
1. Admin searches for student/invoice
2. System loads pending invoices
3. Admin enters payment:
   - Amount (can be partial)
   - Payment date
   - Payment mode (cash/cheque/online/bank)
   - Transaction reference
4. System creates payment record
5. System updates invoice status (pending → partial → paid)
6. System generates receipt
```

**APIs:**
- `GET /api/v1/fees/invoices/` - List invoices
- `POST /api/v1/fees/payments/` - Record payment
- `GET /api/v1/fees/receipts/{id}/` - Get receipt

---

# 4. MODULE SPECIFICATIONS

## 4.1 Authentication Module

### Login
**Endpoint:** `POST /api/v1/auth/login/`
- Input: username/email, password
- Output: JWT tokens (access + refresh) + user info
- Error: 401 if invalid credentials

### Token Refresh
**Endpoint:** `POST /api/v1/auth/refresh/`
- Input: refresh token
- Output: new access token

### Logout
**Endpoint:** `POST /api/v1/auth/logout/`
- Headers: Authorization Bearer token
- Output: Success message

---

## 4.2 School Profile Module

### Get Profile
**Endpoint:** `GET /api/v1/school/profile/`
- Output: School name, logo, address, contact info

### Update Profile
**Endpoint:** `PATCH /api/v1/school/profile/`
- Input: name, logo (file), address, phone, email
- Validations: Name max 200 chars, logo max 2MB, image formats only

---

## 4.3 Teacher Management Module

### Create Teacher
**Endpoint:** `POST /api/v1/teachers/`
- Input: Personal details, email, phone, employee_id, password
- Validations: Email/phone uniqueness, password min 8 chars
- Output: Teacher profile

### List Teachers
**Endpoint:** `GET /api/v1/teachers/`
- Query params: page, page_size, status, search
- Output: Paginated list

### Get/Update/Delete Teacher
**Endpoints:** `GET/PATCH/DELETE /api/v1/teachers/{id}/`

---

## 4.4 Academic Structure Modules

### Classes
- `POST /api/v1/classes/` - Create class
- `GET /api/v1/classes/` - List classes
- `GET/PATCH/DELETE /api/v1/classes/{id}/` - Get/Update/Delete

### Sections
- `POST /api/v1/sections/` - Create section
- `GET /api/v1/sections/` - List sections (filterable by class)
- `GET/PATCH/DELETE /api/v1/sections/{id}/` - Get/Update/Delete

### Subjects
- `POST /api/v1/subjects/` - Create subject
- `GET /api/v1/subjects/` - List subjects
- `GET/PATCH/DELETE /api/v1/subjects/{id}/` - Get/Update/Delete

### Subject Assignments
- `POST /api/v1/assignments/` - Create assignment
- `GET /api/v1/assignments/` - List assignments (filterable)
- `GET /api/v1/teachers/{id}/assignments/` - Get teacher assignments

---

## 4.5 Student Management Module

### Create Student
**Endpoint:** `POST /api/v1/students/`
- Input: Personal details, contact, academic, parent details
- Validations: Email/phone/aadhaar uniqueness, admission number uniqueness
- Output: Student profile

### List Students
**Endpoint:** `GET /api/v1/students/`
- Query params: class_id, section_id, status, search, page, page_size
- Output: Paginated list

### Get/Update Student
**Endpoints:** `GET/PATCH /api/v1/students/{id}/`

---

## 4.6 Attendance Module

### Get Students for Marking
**Endpoint:** `GET /api/v1/attendance/mark/`
- Query params: class_id, section_id, date (required)
- Output: List of students with previous status

### Mark Attendance
**Endpoint:** `POST /api/v1/attendance/mark/`
- Input: date, class_id, section_id, attendance array (student_id, status, remarks)
- Validations: Date not in future, teacher has permission, no duplicate
- Output: Attendance summary

### List Attendance
**Endpoint:** `GET /api/v1/attendance/`
- Query params: student_id, class_id, section_id, date, date_from, date_to, status
- Output: Paginated list

### Get Student Attendance History
**Endpoint:** `GET /api/v1/attendance/student/{student_id}/`
- Query params: date_from, date_to
- Output: Attendance records + summary (percentage, counts)

### Update Attendance
**Endpoint:** `PATCH /api/v1/attendance/{id}/`
- Note: Can only update on same day

### Get Attendance Statistics
**Endpoint:** `GET /api/v1/attendance/stats/`
- Query params: class_id, section_id, date_from, date_to
- Output: Class/section-wise statistics

---

## 4.7 Fee Management Module

### Fee Structures
- `POST /api/v1/fees/structures/` - Create fee structure
- `GET /api/v1/fees/structures/` - List fee structures
- `GET/PATCH /api/v1/fees/structures/{id}/` - Get/Update

### Invoices
- `POST /api/v1/fees/invoices/generate/` - Generate invoices (individual or bulk)
- `GET /api/v1/fees/invoices/` - List invoices (filterable)
- `GET /api/v1/fees/invoices/{id}/` - Get invoice details

### Payments
- `POST /api/v1/fees/payments/` - Record payment
- `GET /api/v1/fees/payments/` - List payments
- `GET /api/v1/fees/receipts/{payment_id}/` - Get receipt

---

## 4.8 Exam Module (Milestone 3)

### Exams
- `POST /api/v1/exams/` - Create exam
- `GET /api/v1/exams/` - List exams
- `GET/PATCH /api/v1/exams/{id}/` - Get/Update

### Exam Marks
- `POST /api/v1/exams/{exam_id}/marks/` - Enter marks (bulk)
- `GET /api/v1/exams/{exam_id}/results/` - Get results (filterable)

---

## 4.9 Dashboard & Reports

### Dashboards
- `GET /api/v1/dashboard/admin/` - Admin dashboard (stats, summaries)
- `GET /api/v1/dashboard/teacher/` - Teacher dashboard (assignments, pending tasks)
- `GET /api/v1/dashboard/student/` - Student dashboard (own data)

### Reports
- `GET /api/v1/reports/export/` - Export reports (csv/excel/pdf)

---

**END OF PART 1**

**Next:** See Part 2A (Database), Part 2B (API Design), Part 2C (AI & Deployment)

